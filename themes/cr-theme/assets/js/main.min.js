!function(d){function e(){var e=window.navigator.userAgent,t=e.indexOf("MSIE ");if(0<t)return parseInt(e.substring(t+5,e.indexOf(".",t)),10);if(0<e.indexOf("Trident/")){var i=e.indexOf("rv:");return parseInt(e.substring(i+3,e.indexOf(".",i)),10)}var n=e.indexOf("Edge/");return 0<n&&parseInt(e.substring(n+5,e.indexOf(".",n)),10)}function i(e,t){this.$el=e,this.$trigger=null,this.collapsed=!1,this.collapsing=!1,this.className={COLLAPSE:"cr-collapse",SHOW:"cr-collapse-show",COLLAPSING:"cr-collapsing",COLLAPSED:"cr-collapsed"},this.EventsName={TRANSITION_END:"transitionEnd webkitTransitionEnd transitionend oTransitionEnd msTransitionEnd"},this.$el.removeClass(this.className.COLLAPSING).addClass(this.className.COLLAPSE),this.setTrigger(t)}function n(e){this.$el=e,this.accesstoken=this.getData("secretkey"),this.number=2*parseInt(this.getData("number")),this.ccenabled=this.getData("ccenabled"),this.ccpos=parseInt(this.getData("ccpos")),this.feeds=[],this.fetchError=!1,this.imageSize="standard_resolution",this.accesstoken&&0<this.number&&this.init()}window.matchMedia||(window.matchMedia=function(){"use strict";var t=window.styleMedia||window.media;if(!t){var i,n=document.createElement("style"),e=document.getElementsByTagName("script")[0];n.type="text/css",n.id="matchmediajs-test",e?e.parentNode.insertBefore(n,e):document.head.appendChild(n),i="getComputedStyle"in window&&window.getComputedStyle(n,null)||n.currentStyle,t={matchMedium:function(e){var t="@media "+e+"{ #matchmediajs-test { width: 1px; } }";return n.styleSheet?n.styleSheet.cssText=t:n.textContent=t,"1px"===i.width}}}return function(e){return{matches:t.matchMedium(e||"all"),media:e||"all"}}}()),i.prototype.show=function(){var t=this;this.collapsing||this.$el.hasClass(this.className.SHOW)||(this.$el.removeClass(this.className.COLLAPSE).addClass(this.className.COLLAPSING),this.$trigger&&this.$trigger.addClass("mobile-nav-arrow-flip"),this.$el[0].style.height=0,this.collapsing=!0,this.$el.one(this.EventsName.TRANSITION_END,function(e){t.$el.removeClass(t.className.COLLAPSING).addClass(t.className.COLLAPSED).addClass(t.className.SHOW),t.$el[0].style.height="",t.collapsing=!1}),this.$el[0].style.height=this.$el[0].scrollHeight+"px")},i.prototype.hide=function(){var t=this;!this.collapsing&&this.$el.hasClass(this.className.SHOW)&&(this.$el[0].style.height=this.$el[0].getBoundingClientRect().height+"px",this.$el[0].offsetHeight,this.$el.addClass(this.className.COLLAPSING).removeClass(this.className.COLLAPSE).removeClass(this.className.SHOW),this.$trigger&&this.$trigger.removeClass("mobile-nav-arrow-flip"),this.collapsing=!0,this.$el.one(this.EventsName.TRANSITION_END,function(e){t.$el.removeClass(t.className.COLLAPSING).addClass(t.className.COLLAPSE),t.collapsing=!1}),this.$el[0].style.height="")},i.prototype.toggle=function(){this.$el.hasClass(this.className.SHOW)?this.hide():this.show()},i.prototype.setTrigger=function(e){var t=this;e&&e.length&&(this.$trigger=e,this.$trigger.on("click",function(e){e.preventDefault(),t.toggle()}))},n.prototype.getData=function(e){var t=this.$el.data(e);return void 0!==t&&t},n.prototype.parseItem=function(e){var t=null!==e.caption?e.caption.text:"",i=e.images[this.imageSize].url;return{id:e.id,caption:t,url:i,likes:e.likes.count,comments:e.comments.count,plink:e.link,username:e.user.username}},n.prototype.displayFeed=function(e){var t=this.$el;t.find(".cr-instagram-feed-con").html(e),t.trigger("instagramfeedloaded"),t.waitForImages(function(){t.addClass("cr-instagram-feed-image-loaded")}).find(".cr-instagram-feed-item").waypoint(function(){d(this).addClass("cr_start_animation")},{offset:"96%"})},n.prototype.updateFeeds=function(){var t=this;jQuery.ajax({type:"POST",dataType:"json",url:CRTSettings.ajaxURL,data:{action:"cr_update_instagram_feed_cache",feeds:t.feeds},success:function(e){void 0===e&&"OK"!==e.status||t.displayFeed(e.html)},error:function(e){console.log("Feed update errror")}})},n.prototype.fetchMedia=function(){var i=this,e="https://api.instagram.com/v1/users/self/media/recent/?access_token="+this.accesstoken+"&count="+parseInt(this.number);d.ajax({type:"POST",dataType:"jsonp",url:e,success:function(e){if(e&&void 0!==e)if(200===e.meta.code){for(var t=0;t<e.data.length;t++)i.feeds.length<=i.number&&"image"===e.data[t].type&&i.feeds.push(i.parseItem(e.data[t]));0<i.feeds.length&&i.updateFeeds()}else i.fetchError=!0;else i.fetchError=!0},error:function(e){i.fetchError=!0}})},n.prototype.init=function(){this.fetchMedia()},window.CRT={vp:{width:null,height:null,scrollTop:null},$body:null,$wrap:null,$menu:null,$footer:null,$footerLine:null,debounce:function(n,a,s){var o;return function(){var e=this,t=arguments,i=s&&!o;clearTimeout(o),o=setTimeout(function(){o=null,s||n.apply(e,t)},a),i&&n.apply(e,t)}},setViewPort:function(e){(e=e||!1)||(this.vp.width=d(window).width(),this.vp.height=d(window).height(),this.vp.height<768?this.$body.addClass("vp-lt-768"):this.$body.removeClass("vp-lt-768")),this.vp.scrollTop=d(window).scrollTop()},isIE:function(){return!!e()},ieVersion:function(){return e()},isSafariDesktop:function(){return void 0!==window.safari},isMobile:function(){return!(!matchMedia||!matchMedia("only screen and (max-width: 600px)").matches)},isTabPort:function(){return!(!matchMedia||!matchMedia("only screen and (min-width: 600px) and (max-width: 900px)").matches)},isTab:function(){return!(!matchMedia||!matchMedia("only screen and (min-width: 600px) and (max-width: 1365px)").matches)},isMobileTabPort:function(){return this.isMobile()||this.isTabPort()},isMobileTab:function(){return this.isMobile()||this.isTab()},resetMenuProps:function(){this.$menu.find(".cr-menu-level-1.cr-menu-level-inline").css({left:"auto",right:"auto"})},setMenuProp:function(){if(this.isMobileTab())this.resetMenuProps();else{var l=this;this.$menu.find(".cr-menu-level-1.cr-menu-level-inline").each(function(){var e,t,i=d(this),n=i.closest("li"),a=n.width(),s=n.offset().left,o=0,r=(i.offset().left,s+a/2);i.find(">li").each(function(){o+=d(this).outerWidth()}),t=r+o/2>l.vp.width?0:"auto",0===(e=r-o/2<0?0:0===t?"auto":r-o/2)&&0===t&&(o="auto"),i.css({width:o,left:e+"px",right:t+"px"})})}},mobileMenu:function(){d(".mobile-nav-arrow").each(function(){var e=d(this),t=e.siblings(".sub-menu");t.length&&new i(t,e)})},bookingPanel:function(){var t=this,e=d("#booking-panel"),a=d("form",e);function n(){var e,t,i,n,a,s,o,r,l,d;a=$checkin.datepicker("getDate"),s=$checkout.datepicker("getDate"),e=a.getDate(),t=a.getMonth()+1,i=a.getFullYear(),$fieldDay.val(e),$fieldYM.val(i+"-"+t),$fieldCI.val(i+"-"+t+"-"+e),n=Math.max(1,(o=s,r=a.getTime(),l=o.getTime(),d=Math.abs(r-l),Math.round(d/864e5))),$fieldNights.val(n)}$dummy=d("#residences-keyword-dummy",e),$keywordWrap=d("#booking-panel-residences"),$residence=d("#residences-keyword",e),$fieldsWrap=d(".booking-panel-fields",e),$checkout=d("#booking-panel-departure-dummy",e),$checkin=d("#booking-panel-checkin-dummy",e),$fieldDay=d("#booking-panel-day",e),$fieldYM=d("#booking-panel-ym",e),$fieldCI=d("#booking-panel-checkin",e),$fieldNights=d("#booking-panel-nights",e),$fieldPromo=d("#booking-panel-promo",e),$fieldKeyword=d("#keyword",e),e.length&&"undefined"!=typeof BookingPanelData&&(d.widget("custom.bookingpanel",d.ui.autocomplete,{_create:function(){var i=this;this.currentResidene,this.panelCol=this.element.closest(".booking-panel-col"),this.panelFields=this.element.closest(".booking-panel-fields"),this.scrollerWrap=this.panelFields.find(".booking-panel-dd-scroller"),this.errorMessage=this.element.data("errormessage"),this._super(),this.widget().menu("option","items",".booking-panel-dd-item"),this.menu.element.addClass("booking-panel-dd-menu"),this._on(this.element,{bookingpanelopen:function(e,t){i.menu.element.addClass("booking-panel-dd-menu-active")},bookingpanelclose:function(e,t){i.menu.element.removeClass("booking-panel-dd-menu-active")}})},_renderMenu:function(e,t){var i=this;this.currentResidene=this.element.val();var n=d("<ul>").addClass("booking-panel-dd-wrap");void 0!==t.error&&t.error?(this.errorMessage&&d("<li>").addClass("bookig-panel-dd-error").html(this.errorMessage.replace("%search_term%","<strong>"+this._value()+"</strong>")).appendTo(n),n.appendTo(e),$fieldKeyword.val("*"),a.addClass("booking-panel-keyword-error")):(d.each(t,function(e,t){i._renderColumn(n,t)}),0<n.find(">li").length?(d("<li>").addClass("booking-panel-dd-wrapli").append(n).appendTo(e),d("<li>").addClass("booking-panel-dd-scroller").append("<span></span>").appendTo(e)):this.errorMessage&&d("<li>").addClass("bookig-panel-dd-error").html(this.errorMessage).appendTo(e),a.removeClass("booking-panel-keyword-error"))},_renderColumn:function(e,t){var n=this,a=d('<li class="booking-panel-dd-col"></li>');return d.each(t,function(e,t){var i=d("<ul>").addClass("booking-panel-dd-group");d.each(t.items,function(e,t){n._renderItem(i,t)}),0<i.find(">li").length&&(a.append('<span class="booking-panel-dd-group-name">'+t.groupName+"</span>"),a.append(i))}),a.appendTo(e)},_renderItem:function(e,t){var i=d("<li>");this.currentResidene===t.value&&i.addClass("cr-state-active"),t.disable&&i.addClass("ui-state-disabled"),i.html(t.value).addClass("booking-panel-dd-item").data("ui-autocomplete-item",t).appendTo(e)},_resizeMenu:function(){var t=this.menu.element.find(".booking-panel-dd-wrapli"),e=this.menu.element.find(".booking-panel-dd-wrap");this.menu.element.css({width:this.panelCol.outerWidth(),height:this.panelFields.outerHeight()-this.panelCol.outerHeight()-3}),t.outerHeight()<e.outerHeight()?(t.mCustomScrollbar({axis:"y"}),this.menu.element.addClass("booking-panel-dd-hasscroller"),d(".booking-panel-dd-scroller span").on("click",function(e){e.preventDefault(),t.mCustomScrollbar("scrollTo","-="+t.outerHeight())})):this.menu.element.removeClass("booking-panel-dd-hasscroller")},__response:function(e){e&&(e=this._normalize(e)),this._trigger("response",null,{content:e}),!this.options.disabled&&e&&e.length&&!this.cancelSearch?this._suggest(e):this._suggest({error:!0}),this._trigger("open")},_appendTo:function(){var e=this.options.appendTo;return e&&(e=e.jquery||e.nodeType?d(e):this.document.find(e).eq(0)),e&&e[0]||(e=d(".booking-panel-dd-position")),e&&e[0]||(e=this.element.closest(".ui-front, dialog")),e.length||(e=this.document[0].body),e}}),$checkout.datepicker({dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],firstDay:1,dateFormat:"dd MM yy",minDate:1,onSelect:function(e,t){$checkout.removeClass("bp-date-picker-shown"),d("#bp-departure-date .booking-panel-day strong").html(d.datepicker.formatDate("dd",new Date(e))),d("#bp-departure-date .booking-panel-monthyear").html(d.datepicker.formatDate("MM yy",new Date(e))),n()}}),$checkout.datepicker("setDate",1),d("#bp-departure-date .booking-panel-day strong").html(d.datepicker.formatDate("dd",$checkout.datepicker("getDate"))),d("#bp-departure-date .booking-panel-monthyear").html(d.datepicker.formatDate("MM yy",$checkout.datepicker("getDate"))),$checkin.datepicker({dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],firstDay:1,dateFormat:"dd MM yy",minDate:0,onSelect:function(e,t){if(e){var i=new Date(e);i.setDate(i.getDate()+1),$checkout.datepicker("option","minDate",i),$checkin.removeClass("bp-date-picker-shown"),d("#bp-departure-date .booking-panel-day strong").html(d.datepicker.formatDate("dd",$checkout.datepicker("getDate"))),d("#bp-departure-date .booking-panel-monthyear").html(d.datepicker.formatDate("MM yy",$checkout.datepicker("getDate")))}d("#bp-arrival-date .booking-panel-day strong").html(d.datepicker.formatDate("dd",new Date(e))),d("#bp-arrival-date .booking-panel-monthyear").html(d.datepicker.formatDate("MM yy",new Date(e))),n()}}),n(),d("#bp-arrival-date .booking-panel-day strong").html(d.datepicker.formatDate("dd",$checkin.datepicker("getDate"))),d("#bp-arrival-date .booking-panel-monthyear").html(d.datepicker.formatDate("MM yy",$checkin.datepicker("getDate"))),d("#bp-arrival-date").on("click",function(e){$checkout.removeClass("bp-date-picker-shown"),d(".booking-panel-select-box").removeClass("cr-show-selectbox"),$checkin.toggleClass("bp-date-picker-shown")}),d("#bp-departure-date").on("click",function(e){$checkin.removeClass("bp-date-picker-shown"),d(".booking-panel-select-box").removeClass("cr-show-selectbox"),$checkout.toggleClass("bp-date-picker-shown")}),d(".booking-panel-sb-trigger").on("click",function(e){e.preventDefault();var t=d(this).closest(".booking-panel-col").find(".booking-panel-select-box");$checkin.removeClass("bp-date-picker-shown"),$checkout.removeClass("bp-date-picker-shown"),d(".booking-panel-select-box").not(t).removeClass("cr-show-selectbox"),t.toggleClass("cr-show-selectbox")}),d(".booking-panel-select-box li").on("click",function(e){e.preventDefault();var t=d(this);t.data("value");t.siblings(".cr-sb-selected").not(t).removeClass("cr-sb-selected"),t.addClass("cr-sb-selected").closest(".booking-panel-col").find(".booking-panel-sb-trigger strong").html(t.text()).end().find("select").val(t.data("value")),t.closest(".booking-panel-select-box").removeClass("cr-show-selectbox")}),d(".booking-panel-message-close a",a).on("click",function(e){e.preventDefault(),a.removeClass("booking-panel-action-error")}),$residence.val()?$keywordWrap.removeClass("cr-booking-no-keyword"):$keywordWrap.addClass("cr-booking-no-keyword"),$residence.on("change keyup",function(e){$residence.val()?$keywordWrap.removeClass("cr-booking-no-keyword"):$keywordWrap.addClass("cr-booking-no-keyword"),$dummy.html($residence.val())}).bookingpanel({minLength:0,source:BookingPanelData.source,position:{my:"left top",at:"left top",of:d(".booking-panel-dd-position",e)},open:function(e,t){$checkin.removeClass("bp-date-picker-shown"),$checkout.removeClass("bp-date-picker-shown"),d(".booking-panel-select-box").removeClass("cr-show-selectbox"),console.log(a.data("triggeredbyarrow")),a.data("triggeredbyarrow")||$fieldKeyword.val(""),a.data("triggeredbyarrow",!1)},select:function(e,t){$dummy.html(t.item.value),$fieldKeyword.val(t.item.keyword),$keywordWrap.removeClass("cr-booking-no-keyword")},source:function(s,e){var o=new RegExp(d.ui.autocomplete.escapeRegex(s.term),"i"),r=new RegExp("^"+d.ui.autocomplete.escapeRegex(s.term),"i"),i=[];d.each(BookingPanelData.column,function(e,t){var a=[];d.each(t,function(e,t){var i={},n=[];!s.term||r.test(e)?i={groupName:e,items:t}:(d.each(t,function(e,t){(function(e,t){for(var i=0;i<t.length;i++)if(e.test(t[i]))return!0;return!1})(o,t.search)&&n.push(t)}),0<n.length&&(i.groupName=e,i.items=n)),void 0!==i.items&&0<i.items.length&&a.push(i)}),0<a.length&&i.push(a)}),e(i)}}),e.find("#booking-panel-dd-keywords").on("click",function(e){e.preventDefault(),a.data("triggeredbyarrow",!0),t.$body.hasClass("cr-ie11")&&$residence.focus(),$residence.bookingpanel("widget").is(":visible")?$residence.bookingpanel("close"):$residence.bookingpanel("search","")}),a.on("submit",function(e){var t=$fieldKeyword.val(),i=$fieldKeyword.find("option:selected").data("actionurl");return a.hasClass("booking-panel-keyword-error")?(e.preventDefault(),!1):i?(a.attr("action",i),"*"===t?a.append('<input type="hidden" name="fw_submitted" id="fw_submitted" value="1" />'):"KNIGHTSBRIDGE"!==t&&"KENSINGTON"!==t&&"SLOANE"!==t&&"CITY"!==t||a.append('<input type="hidden" name="fw_submitted" id="fw_submitted" value="1" />'),1===(i.match("/portal/")||[]).length||1===(i.match("/sda.php")||[]).length||1===(i.match("/mda.php")||[]).length||($fieldPromo.val()?(a.append('<input type="hidden" name="fw_submitted" id="fw_submitted" value="1" />'),a.append('<input type="hidden" name="av" id="av" value="promo" />')):(a.append('<input type="hidden" name="fw_submitted" id="fw_submitted" value="1" />'),a.append('<input type="hidden" name="av" id="av" value="search" />'))),window._gaq=window._gaq||[],void window._gaq.push(["_linkByPost",a.get(0)])):(a.addClass("booking-panel-action-error"),a.find(".booking-panel-message-text").html("Please select a Residence"),e.preventDefault(),!1)}))},scrollHeader:function(){if(!this.$body.hasClass("fixed-header"))return!1;0<this.vp.scrollTop?!this.$body.hasClass("header-scrolled")&&this.$body.addClass("header-scrolled"):this.$body.hasClass("header-scrolled")&&this.$body.removeClass("header-scrolled")},scrollFooter:function(){var e=this.$footerLine.offset().top+this.$footer.outerHeight()-100;this.vp.scrollTop+this.vp.height>e?!this.$body.hasClass("cr-animate-footer")&&this.$body.addClass("cr-animate-footer"):this.$body.hasClass("cr-animate-footer")&&this.$body.removeClass("cr-animate-footer")},scrollEvents:function(){this.setViewPort(!0),this.scrollHeader()},resizeFooter:function(){this.isTabPort()&&this.$body.css({"padding-bottom":"0px"});var e=this.$footer.outerHeight(!0);this.$body.css({"padding-bottom":e+"px"})},resizeEevents:function(){this.setViewPort(),this.setMenuProp()},hidePreloader:function(){d(".loading-animation").length&&d(".loading-animation").fadeOut(250,function(){d(".loading-animation").remove()})},events:function(){var t=this;d("html").hasClass("touchevents"),d(window).scroll(d.proxy(this.scrollEvents,this)),d(window).on("resize",CRT.debounce(function(){CRT.resizeEevents()},250)),d(".mobile-menu-humburger").on("click",function(){t.$body.toggleClass("cr-mobile-menu-active")}),d(".cr-menu-level-1 > li").on("mouseenter",function(){d(this).addClass("on-hover").removeClass("not-hover").siblings("li").removeClass("on-hover").addClass("not-hover")}).on("mouseleave",function(){var e=d(this);e.hasClass("menu-item-has-children")?e.closest(".menu-item-depth-0").addClass("tertiary-menu-strecthed"):e.closest(".menu-item-depth-0").removeClass("tertiary-menu-strecthed"),d(this).removeClass("on-hover").siblings("li").removeClass("not-hover")}),d(".menu-item-depth-0").on("mouseleave",function(){d(this).removeClass("tertiary-menu-strecthed")}),d(".booking-panel-trigger").on("click",function(e){e.preventDefault(),t.$body.addClass("booking-panel-shown")}),d(".booking-panel-close").on("click",function(e){e.preventDefault(),t.$body.removeClass("booking-panel-shown")}),d(".cr-scroll-up").on("click",function(e){e.preventDefault(),window.scroll&&!t.$body.hasClass("cr-ie11")?window.scroll({top:0,left:0,behavior:"smooth"}):d("html, body").animate({scrollTop:0},750,"linear")})},timeLine:function(){d(".sticky-side-nav").length&&setTimeout(function(){d(".sticky-side-nav").addClass("sticky-side-nav-collasped sticky-side-nav-collasped-started"),d(".sticky-side-nav").length&&setTimeout(function(){d(".sticky-side-nav").removeClass("sticky-side-nav-collasped-started")},2e3)},5e3)},instagramMobSlider:function(e){void 0!==d.fn.slick&&(this.isMobileTabPort()?!e.hasClass("cr-instagram-slider-activated")&&e.addClass("cr-instagram-slider-activated").slick({speed:700,infinite:!0,slidesToScroll:1}):e.hasClass("cr-instagram-slider-activated")&&e.removeClass("cr-instagram-slider-activated").slick("unslick"))},instagramFeed:function(){var t=this;d(".cr-instagram-feed-wrap").on("instagramfeedloaded",function(){var e=d(this).find(".cr-instagram-feed-con");t.instagramMobSlider(e),d(window).on("resize",CRT.debounce(function(){t.instagramMobSlider(e)},250))}).each(function(){d(this).hasClass("cr-fetch-feed")?new n(d(this)):(d(this).trigger("instagramfeedloaded"),d(this).waitForImages(function(){d(this).addClass("cr-instagram-feed-image-loaded")}).find(".cr-instagram-feed-item").waypoint(function(){d(this).addClass("cr_start_animation")},{offset:"96%"}))})},init:function(){this.$body=d("body"),this.$wrap=d("#cr-wrap"),this.$menu=d("#menu-header-primary"),this.$footer=d("#site-footer"),this.$footerLine=d("#footer-top-line"),this.isIE()&&this.$body.addClass("cr-ie cr-ie"+this.ieVersion()),this.isSafariDesktop()&&this.$body.addClass("cr-safari"),this.setViewPort(),this.mobileMenu(),this.setMenuProp(),this.bookingPanel(),this.scrollHeader(),this.events(),this.timeLine(),this.instagramFeed()}},d(document).ready(function(){var e=!1,t=!1,i=!0;function n(){e&&t&&i&&(CRT.init(),CRT.$body.addClass("page-loaded"),CRT.hidePreloader())}void 0===d.fn.revolution&&(i=t=!0),0<d(".cr-rev-slider").length?d(".cr-rev-slider").one("revolution.slide.onloaded",function(e){t=!0,n()}):i=t=!0,d("body").waitForImages(function(){e=!0,n()})})}(jQuery);